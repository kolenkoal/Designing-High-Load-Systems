# 1. Сервис краткосрочной аренды жилья (Airbnb)

Airbnb — международная онлайн-платформа для размещения и поиска краткосрочной аренды жилья. Пользователи могут сдавать своё жильё в аренду или бронировать доступные варианты по всему миру через веб-интерфейс или мобильное приложение. Сервис действует в сотнях стран, предлагает миллионы объектов размещения и связывает гостей с хозяевами по всему миру. [[1](https://ru.wikipedia.org/wiki/Airbnb)]

## 1.1 Аналоги

* Booking.com
* Vrbo
* HomeAway
* Agoda

## 1.2 Целевая аудитория

**Аудитория:** пользователи 18–65 лет, планирующие путешествия, командировки и краткосрочные проживания, а также владельцы жилья, сдающие его в аренду.

**География:** глобальная (220+ стран и регионов). [[2](https://www.demandsage.com/airbnb-statistics)]

**Размер аудитории для моделирования нагрузки:**

* Более **150 млн активных пользователей** во всём мире (оценка на 2025–2026). [[3](https://hotelagio.com/airbnb-statistics)]
* Более **200 млн зарегистрированных пользователей** по оценкам сторонних источников. [[4](https://www.businessofapps.com/data/airbnb-statistics)]


## 1.3 Функционал для проектирования MVP

1. **Поиск жилья:** поиск по локации, датам, числу гостей и фильтры
2. **Каталог объявлений:** карточки объектов, фото, описание, отзывы
3. **Календарь доступности:** отображение доступных и занятых дат, а также синхронизация изменений
4. **Бронирование:** формирование запроса брони, проверка пересечений с другими пользователями
5. **Онлайн-платёж:** интеграция с платёжным провайдером, обработка состояний транзакций
6. **Личный кабинет:** история бронирований, управление объявлениями для хозяев
7. **Отзывы и рейтинги:** после завершения проживания

# 1.4 Продуктовые метрики

| Метрика                                 | Значение | Комментарий / назначение        |
| --------------------------------------- | -------- | ------------------------------- |
| MAU (Monthly Active Users)              | 150 млн  | Активные пользователи в месяц |
| DAU (Daily Active Users)                | 25 млн   | Оценка как 15–20% от MAU        |
| Количество объявлений                   | 8 млн    | Активные листинги на платформе |
| Количество бронирований в год           | 490 млн  | По данным статистики Airbnb |
| Количество бронирований в день          | 1.34 млн | 490 млн / 365                   |
| Количество поисковых запросов в день    | 200 млн  | В среднем 8 поисков на пользователя |
| Количество новых объявлений в день      | 50 тыс   | Добавление нового жилья         |
| Количество отзывов в день               | 500 тыс  | После завершения проживания     |


# Источники

1. Airbnb — онлайн-платформа для поиска и размещения краткосрочной аренды жилья: [https://ru.wikipedia.org/wiki/Airbnb](https://ru.wikipedia.org/wiki/Airbnb)
2. Airbnb Statistics 2026 — более 150 млн пользователей, 8 млн+ активных листингов: [https://www.demandsage.com/airbnb-statistics](https://www.demandsage.com/airbnb-statistics)
3. Airbnb — более 5 млн хозяев и международное покрытие платформы: [https://hotelagio.com/airbnb-statistics](https://hotelagio.com/airbnb-statistics)
4. Airbnb Growth — более 200 млн активных пользователей по оценкам сторонних источников: [https://www.businessofapps.com/data/airbnb-statistics/](https://www.businessofapps.com/data/airbnb-statistics/)

---
# 2. Расчёт нагрузки

## 2.1 Продуктовые метрики

### Исходные данные

| MAU (Monthly Active Users), млн | DAU (Daily Active Users), млн |
|---------------------------------|-------------------------------|
| 150                             | 25                            |

### Stickiness Factor (SF)

Stickiness Factor (SF) показывает, какая доля MAU возвращается ежедневно:

$$SF = \frac{DAU}{MAU} = \frac{25}{150} \approx 16.7\%$$

Для платформы путешествий это ожидаемо: пользователи заходят в период планирования поездки, а не каждый день.

### Average User Storage (AUS)

AUS (Average User Storage) — средний объём реляционных данных на одного пользователя. Медиафайлы вынесены в отдельный раздел.

**Среднее число бронирований на пользователя** считается из метрик задания 1:

$$\frac{490 \text{ млн бронирований/год}}{150 \text{ млн MAU}} \approx 3.3 \text{ поездки/год}$$

Оба числа — из задания 1: 490 млн бронирований [[1]](https://investors.airbnb.com), MAU 150 млн [[2]](https://www.demandsage.com/airbnb-statistics).

Горизонт хранения — 3 года — проектное решение: храним историю бронирований за последние 3 года. Итого: 3.3 × 3 ≈ **9 бронирований на пользователя**.

Размер одной записи бронирования:

| Поле                   | Описание                                                                                                             | Тип          | Байт |
|------------------------|----------------------------------------------------------------------------------------------------------------------|--------------|------|
| booking_id             | уникальный идентификатор бронирования                                                                                | int64        | 8    |
| user_id                | идентификатор гостя                                                                                                  | int64        | 8    |
| listing_id             | идентификатор объявления об аренде                                                                                   | int64        | 8    |
| host_id                | идентификатор владельца жилья — денормализован в запись, чтобы не делать объединение с таблицей объявлений при выплатах и уведомлениях | int64        | 8    |
| check_in, check_out    | даты заезда и выезда                                                                                                 | date × 2     | 8    |
| total_price, service_fee | итоговая стоимость и сервисный сбор                                                                                | DECIMAL(10,2) × 2  | 16   |
| currency               | валюта оплаты (ISO 4217, напр. USD)                                                                                  | char(3)      | 4    |
| guests_count           | количество гостей                                                                                                    | int8         | 1    |
| status                 | статус брони (ожидание / подтверждено / отменено / завершено)                                                        | int8 (enum)  | 1    |
| payment_id             | идентификатор транзакции в платёжной системе                                                                         | int64        | 8    |
| created_at, updated_at | время создания и последнего изменения записи                                                                         | timestamp × 2| 16   |
| special_requests       | пожелания гостя, произвольный текст (в среднем ~80 символов)                                                         | text         | 80   |
| **Итого (поля)**       |                                                                                                                      |              | **166** |

Сырых данных: 166 байт. Индексы по полям `user_id` и `listing_id` (тип B-tree, ~50 байт каждый) добавляют ещё 100 байт. С учётом служебного заголовка строки PostgreSQL (~24 байта [[3]](https://www.postgresql.org/docs/current/storage-page-layout.html#STORAGE-TUPLE-LAYOUT)): 166 + 100 + 24 ≈ **~300 байт**.

Оценки размеров остальных сущностей:

- **Профиль (600 байт)** — имя, email, телефон, ссылка на аватар, настройки уведомлений, язык
- **Сохранённое объявление (50 байт)** — пара (user_id, listing_id) + дата добавления
- **Отзыв (500 байт)** — текст (~300 символов в среднем), числовой рейтинг, дата, идентификаторы гостя и объявления
- **Платёжный токен (200 байт)** — токен карты от платёжного провайдера, тип карты, последние 4 цифры для отображения

| Сущность                 | Кол-во записей | Размер записи, байт  | Итого, байт        |
|--------------------------|----------------|----------------------|--------------------|
| Профиль                  | 1              | 600                  | 600                |
| История бронирований     | 9              | 300                  | 2700               |
| Сохранённые объявления   | 40             | 50                   | 2000               |
| Написанные отзывы        | 6              | 500                  | 3000               |
| Платёжные токены         | 1              | 200                  | 200                |
| **Итого**                |                |                      | **~8500 ≈ 8.5 Кб** |

### Среднее количество действий пользователя в день (СКД)

Берётся активный пользователь из DAU. Число поисков считается из задания 1: 200 млн/день ÷ 25 млн DAU = 8. Просмотры карточек: в среднем ~1 клик на поисковый запрос — иногда пользователь открывает 2–3 варианта для сравнения, иногда не кликает вовсе (результаты не подошли). При 8 запросах в день итого ~7 просмотров. Бронирования и отзывы — доля от DAU:

- бронирования: 1.34 млн/день ÷ 25 млн DAU ≈ 0.05
- отзывы: 0.5 млн/день ÷ 25 млн DAU ≈ 0.02

| Действие                          | Среднее, шт |
|-----------------------------------|-------------|
| Загрузка главной / экрана поиска  | 2           |
| Поисковые запросы                 | 8           |
| Просмотры карточек объявлений     | 7           |
| Проверки дат доступности          | 7           |
| Обращения к профилю / истории     | 1           |
| Оформление бронирования           | 0.05        |
| Написание отзыва                  | 0.02        |
| **Итого**                         | **~25**     |

## 2.2 Технические метрики

### 2.2.1 Хранилище

**Реляционные данные:**

Для профилей берётся 200 млн зарегистрированных пользователей [[5]](https://www.businessofapps.com/data/airbnb-statistics), а не только активных (150 млн MAU): аккаунты хранятся независимо от активности. При этом у неактивных пользователей (50 млн) данных значительно меньше — только профиль (~0.6 Кб), без истории бронирований и отзывов. Итоговый расчёт: 150 млн × 8.5 Кб + 50 млн × 0.6 Кб ≈ 1.3 ТБ.

Накопленный объём бронирований оценивается за 10 лет с учётом роста платформы: в 2014–2018 годах обрабатывалось 50–270 млн бронирований в год [[1]](https://investors.airbnb.com), в 2019–2024 — 190–490 млн. Суммарно за 10 лет — около 3 млрд записей.

Накопленный объём отзывов: по данным Airbnb, на платформе размещено более 1 млрд отзывов [[4]](https://news.airbnb.com/about-us). Берём 1 200 млн как оценку с запасом.

| Сущность                     | Расчёт                                                                                         | Объём       |
|------------------------------|------------------------------------------------------------------------------------------------|-------------|
| Профили пользователей        | 150 млн × 8.5 Кб + 50 млн × 0.6 Кб [[5]](https://www.businessofapps.com/data/airbnb-statistics) | ~1.3 ТБ    |
| Объявления об аренде         | 8 млн × 3 Кб [[5]](https://news.airbnb.com/about-us)                                           | ~24 ГБ     |
| Бронирования (накопленные)   | 3 млрд × 300 байт [[1]](https://investors.airbnb.com)                                       | ~0.9 ТБ    |
| Отзывы (накопленные)         | 1 200 млн × 500 байт [[3]](https://news.airbnb.com/about-us)                                   | ~600 ГБ    |
| **Итого реляционных**        |                                                                                                | **~2.8 ТБ** |

**Медиаконтент (хранится в объектном хранилище, раздаётся через CDN):**

| Тип                                                              | Расчёт                                                               | Объём      |
|------------------------------------------------------------------|----------------------------------------------------------------------|------------|
| Фото объявлений (в среднем 15 фото × 500 КБ)                    | 8 млн × 7.5 МБ [[3]](https://news.airbnb.com/about-us)             | ~60 ТБ    |
| Превью для поиска (те же 15 фото, уменьшены до 80 КБ каждое)    | 8 млн × 1.2 МБ [[5]](https://almanac.httparchive.org)              | ~9.6 ТБ   |
| Фотографии профилей                                              | 150 млн × 150 КБ [[2]](https://www.demandsage.com/airbnb-statistics)| ~22.5 ТБ  |
| **Итого медиа**                                                  |                                                                      | **~92 ТБ** |

**Общий объём хранилища: ~95 ТБ**

### 2.2.2 Сетевой трафик

Основной трафик — загрузка фотографий при просмотре объявлений. Поисковый ответ — список результатов в формате JSON с небольшими превью (~50 КБ). Страница конкретного объявления — несколько полноразмерных фото плюс метаданные, в среднем ~1 МБ.

25 млн DAU × 7 просмотров = 175 млн загрузок страниц в день. Перевод в Гбит/с: 175 ТБ × 1000 ГБ/ТБ × 8 Гбит/ГБ ÷ 86 400 с ≈ 16.2 Гбит/с.

| Тип запроса                        | Суточный объём            | Средняя нагрузка | Пик (×2.5)   |
|------------------------------------|---------------------------|-----------------|--------------|
| Поиск (выдача + превью)            | 200 млн × 50 КБ = 10 ТБ  | 0.93 Гбит/с    | 2.3 Гбит/с  |
| Загрузка страниц объявлений        | 175 млн × 1 МБ = 175 ТБ  | 16.2 Гбит/с    | 40.5 Гбит/с |
| Прочие запросы (профиль, бронирование) | 50 млн × 5 КБ = 0.25 ТБ  | 0.02 Гбит/с    | 0.06 Гбит/с |
| **Итого**                          | **~185 ТБ/сут**           | **~17.2 Гбит/с** | **~43 Гбит/с** |

94% пикового трафика приходится на загрузку фото объявлений (40.5 из 43 Гбит/с), что делает раздачу медиа через CDN (Content Delivery Network) обязательным архитектурным решением, а не опциональным.

### 2.2.3 RPS

RPS (Requests Per Second) — количество запросов к серверу в секунду. Пиковая нагрузка принята в 3× от среднесуточной.

При открытии страницы объявления браузер делает два отдельных запроса: один за данными объявления, второй — за календарём доступности. Итого запросов к сервису доступности: 175 млн/день (1:1 к просмотрам страниц).

Авторизация и обращения к профилю: 25 млн DAU × 2 запроса (вход + обновление сессии) = 50 млн/день.

| Действие                    | Запросов/день | RPS (среднее) | RPS (пик ×3) |
|-----------------------------|--------------|--------------|--------------|
| Поиск                       | 200 млн      | 2315         | 6945         |
| Страницы объявлений         | 175 млн      | 2025         | 6075         |
| Проверка доступности дат    | 175 млн      | 2025         | 6075         |
| Бронирование                | 1.34 млн     | 15.5         | 47           |
| Новые объявления            | 0.05 млн     | 0.6          | 2            |
| Отзывы                      | 0.5 млн      | 5.8          | 17           |
| Авторизация / профиль       | 50 млн       | 578          | 1734         |
| **Итого**                   |              | **~6965**    | **~26900**   |

### Итоговая таблица продуктовых метрик

| Метрика | Значение |
|---|---|
| MAU | 150 млн |
| DAU | 25 млн |
| Stickiness | 16.7% |
| Средний объём данных на пользователя | 8.5 КБ |
| Среднее число действий в день | 25 |
| Бронирований на пользователя | 9 |

## Список источников

1. Airbnb Q3 2024 Shareholder Letter — данные по бронированиям и активным пользователям: [https://investors.airbnb.com](https://investors.airbnb.com)
2. Airbnb Statistics 2026 — DemandSage: оценки DAU, частоты использования: [https://www.demandsage.com/airbnb-statistics](https://www.demandsage.com/airbnb-statistics)
3. PostgreSQL Table Row Layout [https://www.postgresql.org/docs/current/storage-page-layout.html#STORAGE-TUPLE-LAYOUT](https://www.postgresql.org/docs/current/storage-page-layout.html#STORAGE-TUPLE-LAYOUT)
4. Airbnb Newsroom — 8 млн+ активных объявлений, 1 млрд+ отзывов: [https://news.airbnb.com/about-us](https://news.airbnb.com/about-us)
5. Business of Apps, Airbnb Revenue and Usage Statistics — данные по зарегистрированным пользователям: [https://www.businessofapps.com/data/airbnb-statistics](https://www.businessofapps.com/data/airbnb-statistics)
6. HTTP Archive / Web Almanac 2024 — средний размер страницы и медиапейлоада: [https://almanac.httparchive.org](https://almanac.httparchive.org)

---

# 3. Глобальная балансировка нагрузки

## 3.1 Разделение трафика на группы по характеру нагрузки

Трафик разделяется на группы по типу операции и требованиям к задержке и консистентности данных:

| Группа | Тип нагрузки | Примеры запросов | Требования |
|--------|--------------|------------------|------------|
| **Чтение, кэшируемое** | Поиск, выдача объявлений, превью | Поиск (200 млн/день), страницы объявлений (175 млн/день), проверка доступности дат (175 млн/день) | Низкая задержка, допустима eventual consistency, раздача через CDN/edge |
| **Чтение, персональное** | Профиль, история, сессия | Авторизация / профиль (50 млн/день) | Задержка важна, данные привязаны к пользователю, желательно к одному ДЦ |
| **Запись, критичная** | Транзакции и мутации | Бронирование (1.34 млн/день), новые объявления (50 тыс/день), отзывы (500 тыс/день) | Консистентность и надёжность, один источник истины (primary ДЦ) |

Для MVP с одним базовым датацентром вся серверная логика обслуживается этим ДЦ; кэшируемый трафик (поиск, медиа) выносится на CDN и не идёт в ДЦ целиком.

## 3.2 Физическое расположение датацентра (базово одного)

**Выбор: один основной датацентр (ДЦ)** в регионе **Западная Европа** (например, Амстердам или Франкфурт).

**Обоснование:**

- Центральное положение между основными рынками (Европа, частично Ближний Восток и Африка), приемлемые RTT для значимой доли DAU.
- Развитая инфраструктура, надёжные каналы связи и соответствие регуляториям (GDPR и др.).
- Один ДЦ упрощает консистентность данных (бронирования, платежи), снижает стоимость и сложность на этапе MVP.

Резервный/DR-датацентр на следующем этапе можно добавить в том же регионе (другая зона доступности) или в Восточной Европе.

## 3.3 Схема глобальной балансировки до датацентров

При одном ДЦ схема плоская: весь не-CDN трафик направляется в этот ДЦ.

```
                    ┌─────────────────────────────────────────┐
                    │              Глобальный трафик           │
                    └─────────────────────┬───────────────────┘
                                          │
                    ┌─────────────────────▼───────────────────┐
                    │  DNS / Anycast (опционально для MVP)     │
                    │  app.example.com → IP основного ДЦ       │
                    └─────────────────────┬───────────────────┘
                                          │
         ┌────────────────────────────────┼────────────────────────────────┐
         │                                │                                │
         ▼                                ▼                                ▼
┌─────────────────┐            ┌─────────────────┐            ┌─────────────────┐
│   CDN (медиа,   │            │  Основной ДЦ     │            │  (Резервный ДЦ   │
│   статика,      │            │  (Зап. Европа)  │            │   — на будущее)  │
│   поиск-cache)  │            │  API, БД, очереди│            │                 │
└─────────────────┘            └─────────────────┘            └─────────────────┘
```

По группам нагрузки:

- **Кэшируемое чтение (поиск, объявления, доступность):** запрос может обслуживаться CDN/edge; при cache miss — запрос в основной ДЦ.
- **Персональное чтение и запись:** все запросы идут в основной ДЦ (единая точка консистентности).

При появлении второго ДЦ балансировка по группам может быть расширена: например, read replica в другом регионе для чтения, запись по-прежнему только в primary.

## 3.4 Функциональное разбиение по доменам

Для связи балансировки с продуктом выделяются домены (bounded contexts):

| Домен | Назначение | Отношение к ДЦ |
|-------|------------|----------------|
| **Search & Listings** | Поиск, каталог, карточки объявлений, превью | Кэш на edge/CDN, origin в ДЦ |
| **Availability** | Календарь, проверка дат | API в ДЦ, при необходимости кэш по listing_id |
| **Bookings** | Бронирование, отмена, история | Только ДЦ (транзакции) |
| **Payments** | Платёжный провайдер, статусы | Только ДЦ |
| **Identity & Profile** | Авторизация, профиль, настройки | Только ДЦ (сессии, персональные данные) |
| **Reviews** | Отзывы и рейтинги | Запись в ДЦ, чтение можно кэшировать |

Разбиение нужно для следующего пункта: обоснование размещения ДЦ и распределения запросов по типам и ДЦ.

## 3.5 Обоснование расположения ДЦ (влияние на продуктовые метрики)

| Продуктовая метрика | Влияние расположения ДЦ |
|---------------------|-------------------------|
| **Конверсия поиск → бронирование** | Задержка ответа поиска и страницы объявления влияет на отказы. Снижение: отдача поиска и медиа через CDN по географии пользователя; в ДЦ идут только cache miss и персональные запросы. |
| **Время до первого контента (TTFB)** | Европейский ДЦ даёт приемлемый RTT (50–150 ms) для Европы и части СНГ/Ближнего Востока; для Америки и Азии задержка выше — компенсируется кэшем поиска и медиа на edge. |
| **Надёжность бронирований и платежей** | Один ДЦ — одна зона консистентности: нет конфликтов репликации, проще соблюдать ACID и корректность финансовых операций. |
| **MAU/DAU и удержание** | Стабильность и предсказуемая задержка важнее экстремально низкого latency для туристического сценария; один правильно выбранный ДЦ достаточен для MVP. |

Итог: размещение основного ДЦ в Западной Европе при разгрузке через CDN даёт приемлемые задержки для большей части пользователей и сохраняет простоту и надёжность для критичных к консистентности операций.

## 3.6 Распределение запросов по типам по датацентрам

При одном ДЦ 100% серверных запросов обрабатываются в нём. Ниже — разбиение из раздела «Расчёт нагрузки» по типам и по тому, что реально попадает в ДЦ (с учётом того, что часть чтения обслуживается CDN).